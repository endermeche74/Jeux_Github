<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Mastery Hub - Ultimate</title>
    <style>
        :root {
            --bg: #121212; --panel: #1e1e1e;
            --gold: #f1c40f; --text: #ffffff;
            --green: #27ae60; --red: #c0392b; --blue: #2980b9;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 30px; }
        .screen { width: 100%; max-width: 600px; padding: 15px; margin: auto; box-sizing: border-box; display: none; min-height: 100vh; }
        .active { display: block; }

        /* --- NAVIGATION --- */
        .nav-header { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 10px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        .nav-btn { background: transparent; border: none; color: #ccc; cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 0.7rem; font-weight: bold; }
        .nav-btn span { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-btn:hover { color: var(--gold); }

        /* --- UI ELEMENTS --- */
        .glass { background: var(--panel); border: 1px solid #333; border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); position: relative; cursor: pointer; transition: 0.2s; }
        .glass:hover { background: #252525; }
        .btn-main { width: 100%; padding: 16px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; transition: 0.2s; margin-top: 10px; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-action { flex: 1; background: #333; color: white; border: 1px solid #555; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-action:disabled { opacity: 0.2; cursor: not-allowed; background: #222; color: #555; }
        
        /* Gros bouton Nouvelle Main */
        .btn-side-big {
            width: 100%; height: 100%; min-height: 120px;
            background: var(--gold); color: black; border: none; border-radius: 15px;
            font-size: 1.4rem; font-weight: 800; text-transform: uppercase; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4); padding: 20px;
        }

        /* --- BLACKJACK LAYOUT --- */
        .bj-container { display: flex; gap: 15px; flex-direction: column; } /* Mobile friendly column */
        @media(min-width: 450px) { .bj-container { flex-direction: row; } }
        
        .bj-table-style {
            background-color: #27ae60; border: 5px solid #3e2723; border-radius: 15px; padding: 15px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.5); flex: 3;
        }

        /* --- CARDS & HANDS --- */
        .hand-wrapper { display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; min-height: 100px; }
        
        /* Style pour une main active (bordure or) */
        .active-hand-box { border: 2px solid var(--gold); background: rgba(0,0,0,0.2); border-radius: 10px; padding: 5px; }
        .inactive-hand-box { border: 2px solid transparent; opacity: 0.7; padding: 5px; }

        .card { 
            width: 60px; height: 90px; background: white; border-radius: 6px; color: black; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4); position: relative;
            animation: dealCard 0.4s ease-out;
        }
        @keyframes dealCard { from { transform: translateY(-50px) scale(0.8); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        
        .card-hidden { background: #2c3e50; border: 2px solid #fff; color: transparent; }
        .card-red { color: var(--red); }
        .card-black { color: black; }
        .card::after { content: attr(data-suit); position: absolute; top: 2px; right: 4px; font-size: 0.8rem; }

        /* --- VITESSE --- */
        .speed-card-box { height:260px; width:180px; background:white; border-radius:15px; margin:40px auto; display:flex; align-items:center; justify-content:center; font-size:6rem; color:black; font-weight:bold; box-shadow: 0 0 30px rgba(46,204,113,0.4); }

        /* --- MODALS --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .modal-box { background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid var(--gold); text-align: center; width: 100%; max-width: 350px; }

        /* --- PAPAYOO --- */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        th, td { border: 1px solid #444; padding: 8px; text-align: center; }
        .p-input { width: 50px; padding: 5px; text-align: center; background: #333; color: white; border: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="scr-home" class="screen active">
        <h1 style="text-align: center; color: var(--gold); letter-spacing: 6px; margin: 50px 0;">MASTERY HUB</h1>
        
        <div class="glass" onclick="setupBlackjack()" style="border-left: 5px solid var(--gold);">
            <h2 style="margin:0;">üÉè Blackjack R√©el</h2>
            <p style="color:#888; font-size:0.9rem;">Dealer, Split, Double & R√®gles Strictes.</p>
        </div>

        <div class="glass" onclick="setupSpeed()" style="border-left: 5px solid var(--green);">
            <h2 style="margin:0;">‚è±Ô∏è Vitesse Hi-Lo</h2>
            <p style="color:#888; font-size:0.9rem;">Entra√Ænement au comptage (Cartes muettes).</p>
        </div>

        <div class="glass" onclick="setupPapayoo()" style="border-left: 5px solid var(--blue);">
            <h2 style="margin:0;">üé≠ Papayoo</h2>
            <p style="color:#888; font-size:0.9rem;">Compteur de points classique.</p>
        </div>
    </div>

    <div id="bj-setup" class="screen">
        <div class="nav-header">
            <button class="nav-btn" onclick="goHome()"><span>üè†</span>Accueil</button>
            <h3 style="margin:0; color:var(--gold)">SETUP BJ</h3>
            <div style="width:30px"></div>
        </div>
        <div class="glass" style="cursor:default;">
            <label style="color:#aaa;">Nombre de Decks</label>
            <select id="deck-count" style="width:100%; padding:10px; margin:10px 0; background:#333; color:white;">
                <option value="6">6 Decks (Standard)</option>
                <option value="1">1 Deck</option>
                <option value="2">2 Decks</option>
            </select>
            <button class="btn-main btn-gold" onclick="startBlackjackGame()">JOUER</button>
        </div>
    </div>

    <div id="bj-game" class="screen">
        <div class="nav-header" style="margin-bottom: 10px;">
             <button class="nav-btn" style="color:#e74c3c;" onclick="goHome()"><span>üö™</span>Quitter</button>
             <h3 style="margin:0; color:var(--gold)">TABLE BLACKJACK</h3>
             <div style="width:30px"></div>
        </div>

        <div class="bj-container">
            <div class="bj-table-style">
                <div style="text-align:center;">
                    <div style="font-size:0.8rem; color:#eee; margin-bottom:5px; background:rgba(0,0,0,0.3); display:inline-block; padding:2px 8px; border-radius:10px;">CROUPIER: <span id="d-score" style="font-weight:bold;">?</span></div>
                    <div id="d-hand-area" class="hand-wrapper"></div>
                </div>

                <div id="game-msg" style="text-align:center; font-weight:bold; color:var(--gold); font-size:1.2rem; height:25px; margin: 5px 0; text-shadow: 1px 1px 2px black;"></div>

                <div id="p-hands-container" style="text-align:center; min-height: 150px;">
                    </div>
            </div>

            <div style="flex:1; display:flex; flex-direction:column; gap:10px;">
                <button class="btn-side-big" onclick="startBlackjackGame()">NOUVELLE MAIN</button>
            </div>
        </div>

        <div class="controls" id="controls" style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn-action" style="background:#27ae60;" onclick="playerHit()">TIRER</button>
            <button class="btn-action" style="background:#c0392b;" onclick="playerStand()">RESTER</button>
            <button class="btn-action" id="btn-double" style="background:#f39c12; color:black;" onclick="playerDouble()">DOUBLER</button>
            <button class="btn-action" id="btn-split" style="background:#2980b9;" onclick="playerSplit()">SPLIT</button>
        </div>
    </div>

    <div id="speed-setup" class="screen">
        <div class="nav-header">
            <button class="nav-btn" onclick="goHome()"><span>üè†</span>Accueil</button>
            <h3 style="margin:0; color:var(--green)">SETUP VITESSE</h3>
            <div style="width:30px"></div>
        </div>
        <div class="glass" style="cursor:default;">
            <label style="font-size:0.8rem; color:#aaa;">Vitesse (sec/carte)</label>
            <input type="number" id="speed-sec" value="1.5" step="0.5" style="width:100%; padding:12px; background:#333; color:white; border:1px solid #444; border-radius:8px; margin:10px 0;">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-top:15px; color:#ccc;">
                <span>Arr√™t Al√©atoire</span>
                <input type="checkbox" id="speed-random" checked style="transform: scale(1.5);">
            </div>
            <button class="btn-main" style="background:var(--green); color:white;" onclick="startSpeedGame()">D√âMARRER</button>
        </div>
    </div>

    <div id="speed-game" class="screen">
        <div class="nav-header">
            <button class="nav-btn" onclick="goHome()"><span>üè†</span>Quitter</button>
            <h3 style="margin:0; color:var(--green)">HI-LO TRAINING</h3>
            <button class="nav-btn" style="color:var(--red);" onclick="startSpeedGame()"><span>üîÑ</span>Reset</button>
        </div>

        <div id="speed-card-box" class="speed-card-box">?</div>
        
        <div id="speed-hint" style="text-align:center; color:var(--green); font-weight:bold; height:30px; margin-bottom:10px; font-size:1.2rem;"></div>

        <button class="btn-main btn-gold" onclick="checkCount()">V√âRIFIER LE COMPTE (STOP)</button>
        <button class="btn-main" style="background:#333; color:white; margin-top:10px;" onclick="toggleSpeedPause()">PAUSE / REPRENDRE</button>
    </div>

    <div id="papayoo" class="screen">
        <div class="nav-header">
            <button class="nav-btn" onclick="goHome()"><span>üè†</span>Accueil</button>
            <h3 style="margin:0; color:var(--blue)">PAPAYOO</h3>
            <button class="nav-btn" onclick="setupPapayoo()"><span>üóëÔ∏è</span>Reset</button>
        </div>
        <div id="p-setup-area">
            <input type="text" class="p-name" placeholder="Joueur 1" style="width:100%; margin-bottom:5px; padding:10px; background:#333; border:1px solid #444; color:white;">
            <input type="text" class="p-name" placeholder="Joueur 2" style="width:100%; margin-bottom:5px; padding:10px; background:#333; border:1px solid #444; color:white;">
            <input type="text" class="p-name" placeholder="Joueur 3" style="width:100%; margin-bottom:5px; padding:10px; background:#333; border:1px solid #444; color:white;">
            <button class="btn-main" style="background:var(--blue);" onclick="runPapayoo()">LANCER</button>
        </div>
        <div id="p-play-area" class="hidden">
            <button class="btn-main" style="background:#333;" onclick="rollColor()">üé≤ TIRER COULEUR</button>
            <div id="p-color-res" style="text-align:center; font-weight:bold; margin:10px; font-size:1.2rem;">--</div>
            <table id="p-table"><thead><tr id="p-head"></tr></thead><tbody id="p-body"></tbody><tfoot><tr id="p-foot"></tr></tfoot></table>
            <button class="btn-main" style="background:var(--blue); margin-top:10px;" onclick="savePRound()">VALIDER MANCHE</button>
        </div>
    </div>

    <div id="modal-ana" class="modal">
        <div class="modal-box">
            <h2 style="color:var(--gold); margin-top:0;">R√âSULTAT</h2>
            <div class="glass" style="cursor:default;">
                <p style="color:#888; margin:0;">RUNNING COUNT</p>
                <div id="ana-rc" style="font-size:4rem; font-weight:bold; color:var(--gold);">0</div>
                <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
                <p style="color:#888; margin:0;">TRUE COUNT</p>
                <div id="ana-tc" style="font-size:2rem; font-weight:bold;">0</div>
                <p style="font-size:0.7rem; color:#666;">(Estimation decks restants)</p>
            </div>
            <button class="btn-main btn-gold" onclick="closeModal()">FERMER</button>
        </div>
    </div>

    <script>
        // --- GLOBAL & NAV ---
        let deck = [], rc = 0, speedTimer = null;
        let pHand = [], dHand = []; // (Obsol√®te pour BJ multi-mains, utilis√© pour compatibilit√© si besoin)
        let playerHands = []; // Tableau d'objets { cards: [], bet: 1, done: false }
        let currentHandIndex = 0;
        let dealerCards = [];
        let bjGameOver = false;

        function showScreen(id) {
            stopAll();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function goHome() { showScreen('scr-home'); }
        function setupBlackjack() { showScreen('bj-setup'); }
        function setupSpeed() { showScreen('speed-setup'); }
        function setupPapayoo() { showScreen('papayoo'); document.getElementById('p-setup-area').classList.remove('hidden'); document.getElementById('p-play-area').classList.add('hidden'); }
        
        function stopAll() {
            clearInterval(speedTimer); speedTimer = null; closeModal();
        }
        function closeModal() { document.getElementById('modal-ana').style.display = 'none'; }

        // --- DECK COMMON ---
        function createDeck(n) {
            const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£']; deck = [];
            for(let i=0; i<n; i++) for(let s of suits) for(let r of ranks) deck.push({r, s});
            for (let i = deck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [deck[i], deck[j]] = [deck[j], deck[i]]; }
            rc = 0;
        }
        function getHiLo(r) {
            if(['2','3','4','5','6'].includes(r)) return 1;
            if(['10','J','Q','K','A'].includes(r)) return -1;
            return 0;
        }

        // ================== BLACKJACK ENGINE (MULTI-MAINS / SPLIT) ==================
        async function startBlackjackGame() {
            if(deck.length < 15) createDeck(parseInt(document.getElementById('deck-count').value) || 6);
            showScreen('bj-game');
            
            // Reset State
            playerHands = [{ cards: [], done: false }];
            currentHandIndex = 0;
            dealerCards = [];
            bjGameOver = false;
            
            document.getElementById('game-msg').innerText = '';
            document.getElementById('d-hand-area').innerHTML = '';
            document.getElementById('p-hands-container').innerHTML = '';
            document.getElementById('controls').classList.add('hidden'); // Cach√© pendant distrib
            
            renderBJ();

            // Distribution Anim√©e
            await dealToPlayer(0);
            await dealToDealer(true);
            await dealToPlayer(0);
            await dealToDealer(false); // Carte cach√©e

            // Check Blackjack Naturel sur la main initiale
            if(getScore(playerHands[0].cards) === 21) {
                document.getElementById('game-msg').innerText = "BLACKJACK !";
                playerHands[0].done = true;
                endBlackjackRound();
            } else {
                document.getElementById('controls').classList.remove('hidden');
            }
            renderBJ();
        }

        async function dealToPlayer(handIdx) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const c = deck.pop();
                    playerHands[handIdx].cards.push(c);
                    renderBJ();
                    resolve();
                }, 350);
            });
        }

        async function dealToDealer(visible) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const c = deck.pop();
                    c.visible = visible; // Flag pour l'affichage
                    dealerCards.push(c);
                    renderBJ();
                    resolve();
                }, 350);
            });
        }

        function renderBJ() {
            // Render Dealer
            const dArea = document.getElementById('d-hand-area');
            dArea.innerHTML = '';
            dealerCards.forEach(c => {
                dArea.appendChild(createCardDOM(c, !c.visible));
            });
            // Score Dealer (seulement visible)
            let dScore = 0;
            const visibleDCards = dealerCards.filter(c => c.visible);
            if(visibleDCards.length > 0) dScore = getScore(visibleDCards);
            document.getElementById('d-score').innerText = dScore;

            // Render Player Hands
            const pContainer = document.getElementById('p-hands-container');
            pContainer.innerHTML = '';
            
            playerHands.forEach((hand, idx) => {
                const handBox = document.createElement('div');
                // Encadr√© or si c'est la main active
                handBox.className = (idx === currentHandIndex && !bjGameOver) ? 'active-hand-box' : 'inactive-hand-box';
                
                const scoreDisplay = document.createElement('div');
                scoreDisplay.style.color = '#ccc';
                scoreDisplay.style.fontSize = '0.8rem';
                scoreDisplay.innerText = `MAIN ${idx+1}: ${getScore(hand.cards)}`;
                handBox.appendChild(scoreDisplay);

                const cardRow = document.createElement('div');
                cardRow.className = 'hand-wrapper';
                hand.cards.forEach(c => {
                    cardRow.appendChild(createCardDOM(c, false));
                });
                handBox.appendChild(cardRow);
                pContainer.appendChild(handBox);
            });

            updateControls();
        }

        function createCardDOM(card, isHidden) {
            const el = document.createElement('div');
            if(isHidden) { el.className = 'card card-hidden'; }
            else {
                el.className = 'card';
                if(card.s === '‚ô•' || card.s === '‚ô¶') el.classList.add('card-red'); else el.classList.add('card-black');
                el.innerHTML = `<div>${card.r}</div><div style="font-size:1.5rem;">${card.s}</div>`;
                el.setAttribute('data-suit', card.s);
            }
            return el;
        }

        function getScore(cards) {
            let s = 0, a = 0;
            cards.forEach(c => {
                if(c.r==='A') a++;
                else if(['K','Q','J','10'].includes(c.r)) s+=10;
                else s+=parseInt(c.r);
            });
            for(let i=0; i<a; i++) s += (s + 11 <= 21) ? 11 : 1;
            return s;
        }

        function updateControls() {
            if(bjGameOver) {
                document.getElementById('controls').classList.add('hidden');
                return;
            }
            const currentHand = playerHands[currentHandIndex];
            if(!currentHand) return;

            // Split: seulement si 2 cartes de m√™me valeur faciale
            const canSplit = (currentHand.cards.length === 2 && currentHand.cards[0].r === currentHand.cards[1].r);
            document.getElementById('btn-split').disabled = !canSplit;

            // Double: seulement si 2 cartes
            const canDouble = (currentHand.cards.length === 2);
            document.getElementById('btn-double').disabled = !canDouble;
        }

        // Actions Joueur
        async function playerHit() {
            const h = playerHands[currentHandIndex];
            await dealToPlayer(currentHandIndex);
            if(getScore(h.cards) > 21) {
                h.done = true;
                nextHand();
            }
        }

        function playerStand() {
            playerHands[currentHandIndex].done = true;
            nextHand();
        }

        async function playerDouble() {
            const h = playerHands[currentHandIndex];
            await dealToPlayer(currentHandIndex);
            h.done = true; // Une seule carte pour double
            nextHand();
        }

        async function playerSplit() {
            const h = playerHands[currentHandIndex];
            const cardToMove = h.cards.pop();
            
            // Cr√©er nouvelle main
            const newHand = { cards: [cardToMove], done: false };
            // L'ins√©rer apr√®s la main courante
            playerHands.splice(currentHandIndex + 1, 0, newHand);
            
            renderBJ();
            // On distribue une carte √† la main courante pour compl√©ter
            await dealToPlayer(currentHandIndex);
            // La main splitt√©e recevra sa carte quand ce sera son tour ou on peut distribuer tout de suite ?
            // R√®gle standard : on distribue aux deux as si split d'as, sinon on joue la premi√®re puis la seconde.
            // On laisse simple : on joue la main courante.
        }

        function nextHand() {
            if(currentHandIndex < playerHands.length - 1) {
                currentHandIndex++;
                renderBJ();
                // Si la nouvelle main n'a qu'une carte (suite √† un split), on lui en donne une 2√®me
                if(playerHands[currentHandIndex].cards.length === 1) {
                     dealToPlayer(currentHandIndex);
                }
            } else {
                endBlackjackRound();
            }
        }

        async function endBlackjackRound() {
            bjGameOver = true;
            document.getElementById('controls').classList.add('hidden');
            
            // R√©v√©ler Dealer
            dealerCards[1].visible = true;
            renderBJ();

            // Dealer joue si au moins un joueur n'a pas bust (optionnel, mais plus r√©aliste)
            // Ici dealer joue toujours pour voir le r√©sultat
            while(getScore(dealerCards) < 17) {
                await dealToDealer(true);
            }

            // R√©sultats
            const dScore = getScore(dealerCards);
            let resultText = "";
            
            // On regarde la main 0 pour le message principal (simplification visuelle)
            // Id√©alement on afficherait gagn√©/perdu sous chaque main
            const pScore = getScore(playerHands[0].cards);
            
            if(pScore > 21) resultText = "BUST !";
            else if(dScore > 21) resultText = "DEALER BUST - GAGN√â !";
            else if(pScore > dScore) resultText = "GAGN√â !";
            else if(pScore < dScore) resultText = "PERDU...";
            else resultText = "PUSH (√âgalit√©)";

            if(playerHands.length > 1) resultText = "FIN DE PARTIE (Multi)";

            document.getElementById('game-msg').innerText = resultText;
        }


        // ================== SPEED GAME ENGINE ==================
        function startSpeedGame() {
            createDeck(6); 
            showScreen('speed-game'); 
            resumeSpeed();
        }
        function resumeSpeed() {
            const spd = parseFloat(document.getElementById('speed-sec').value)*1000;
            const rnd = document.getElementById('speed-random').checked;
            document.getElementById('speed-hint').innerText = "";
            
            speedTimer = setInterval(() => {
                if(deck.length===0) { checkCount(); return; }
                
                if(rnd && Math.random()<0.12) { 
                    clearInterval(speedTimer); speedTimer=null; 
                    document.getElementById('speed-hint').innerText = "ARR√äT AL√âATOIRE !"; 
                    document.getElementById('speed-card-box').innerText="???"; 
                    return; 
                }

                const c = deck.pop(); 
                rc += getHiLo(c.r);
                const box = document.getElementById('speed-card-box'); 
                box.innerText = c.r;
                box.style.color = (c.s==='‚ô•'||c.s==='‚ô¶') ? 'var(--red)' : 'black';
                
            }, spd);
        }
        function toggleSpeedPause() { 
            if(speedTimer){ clearInterval(speedTimer); speedTimer=null; } 
            else resumeSpeed(); 
        }
        function checkCount() {
            clearInterval(speedTimer); speedTimer=null;
            document.getElementById('modal-ana').style.display='flex';
            const dr = Math.max(0.5, deck.length/52);
            document.getElementById('ana-rc').innerText = (rc>0?'+':(rc<0?'':''))+rc;
            document.getElementById('ana-tc').innerText = Math.floor(rc/dr);
        }


        // ================== PAPAYOO ENGINE ==================
        let pPlayers = [];
        function runPapayoo() {
            pPlayers = Array.from(document.querySelectorAll('.p-name')).map(i=>i.value.trim()).filter(n=>n).map(n=>({name:n,scores:[],total:0}));
            if(pPlayers.length===0) return alert("Noms?");
            document.getElementById('p-setup-area').classList.add('hidden'); document.getElementById('p-play-area').classList.remove('hidden'); renderPTable();
        }
        function renderPTable() {
            const h=document.getElementById('p-head'), b=document.getElementById('p-body'), f=document.getElementById('p-foot');
            h.innerHTML='<th>#</th>'+pPlayers.map(p=>`<th>${p.name}</th>`).join('');
            let r=''; const rounds=pPlayers[0].scores.length;
            for(let i=0; i<rounds; i++) r+=`<tr><td>${i+1}</td>${pPlayers.map(p=>`<td>${p.scores[i]}</td>`).join('')}</tr>`;
            r+=`<tr><td>New</td>${pPlayers.map((p,i)=>`<td><input type="number" class="p-input" id="pi-${i}"></td>`).join('')}</tr>`;
            b.innerHTML=r; f.innerHTML='<td>TOT</td>'+pPlayers.map(p=>`<td>${p.total}</td>`).join('');
        }
        function savePRound() {
            const vals=pPlayers.map((_,i)=>parseInt(document.getElementById(`pi-${i}`).value)||0);
            if(vals.reduce((a,b)=>a+b,0)!==250) return alert("Total 250 requis");
            pPlayers.forEach((p,i)=>{p.scores.push(vals[i]); p.total+=vals[i]}); renderPTable();
        }
        function rollColor() {
            const c=['‚ô•','‚ô¶','‚ô£','‚ô†'], cl=['#e74c3c','#e67e22','#27ae60','#2980b9'], r=Math.floor(Math.random()*4);
            const el=document.getElementById('p-color-res'); el.innerText="7 de "+c[r]; el.style.color=cl[r];
        }

    </script>
</body>
</html>
