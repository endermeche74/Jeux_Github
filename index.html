<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Jeux - Hub de Strat√©gie</title>
    <style>
        :root {
            --bg: #0a0a0a; --panel: #161616; --gold: #d4af37; --text: #ffffff;
            --green: #2ecc71; --red: #e74c3c; --blue: #3498db; --grey: #888;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        .screen { width: 100%; max-width: 500px; padding: 15px; margin: auto; box-sizing: border-box; display: none; }
        .active { display: block; }

        /* UI */
        .glass { background: var(--panel); border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 12px; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.75rem; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: black; width: 100%; }
        .btn-action { background: #333; color: white; flex: 1; margin: 3px; border: 1px solid #555; }
        .btn-action:disabled { opacity: 0.2; }

        /* CARDS */
        .hand-container { display: flex; justify-content: center; gap: 5px; min-height: 85px; margin: 10px 0; flex-wrap: wrap; }
        .mini-card { 
            width: 50px; height: 75px; background: white; border-radius: 5px; color: black; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1rem;
            box-shadow: 0 3px 6px rgba(0,0,0,0.5); animation: slide 0.3s ease-out;
        }
        @keyframes slide { from { transform: translateY(-10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .active-hand { border: 2px solid var(--gold); background: rgba(212, 175, 55, 0.05); }

        /* HINTS */
        .hint-box { background: rgba(212, 175, 55, 0.1); border: 1px dashed var(--gold); color: var(--gold); padding: 8px; border-radius: 8px; font-size: 0.75rem; text-align: center; margin-bottom: 10px; }
        
        /* TABLE PAPAYOO */
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th, td { border: 1px solid #333; padding: 5px; text-align: center; }
    </style>
</head>
<body>

    <div id="scr-home" class="screen active">
        <h1 style="text-align: center; color: var(--gold); letter-spacing: 5px; margin: 40px 0;">JEUX</h1>
        
        <div class="glass" onclick="startBlackjack()" style="cursor:pointer; border-left: 5px solid var(--gold);">
            <h3 style="margin:0;">üÉè Blackjack Pro</h3>
            <p style="font-size:0.8rem; color:var(--grey);">R√®gles r√©elles, Split, Double & Aide strat√©gique.</p>
        </div>

        <div class="glass" onclick="startCounting()" style="cursor:pointer; border-left: 5px solid var(--green);">
            <h3 style="margin:0;">‚è±Ô∏è Comptage Rapide</h3>
            <p style="font-size:0.8rem; color:var(--grey);">Entra√Ænement Hi-Lo carte par carte (Auto).</p>
        </div>

        <div class="glass" onclick="showScreen('scr-papayoo')" style="cursor:pointer; border-left: 5px solid var(--blue); opacity:0.8;">
            <h3 style="margin:0;">üé≠ Papayoo</h3>
            <p style="font-size:0.8rem; color:var(--grey);">Compteur de points entre amis.</p>
        </div>
    </div>

    <div id="scr-bj" class="screen">
        <header style="display:flex; justify-content: space-between; align-items: center; margin-bottom:10px;">
            <button class="btn" style="color:var(--gold); background:none;" onclick="showScreen('scr-home')">‚Üê RETOUR</button>
            <div id="bj-deck-info" style="font-size:0.7rem; color:var(--grey);">--</div>
        </header>

        <div id="bj-board">
            <div style="text-align:center; font-size:0.7rem; color:var(--grey);">DEALER <span id="bj-d-score" style="color:var(--gold)">?</span></div>
            <div id="bj-d-hand" class="hand-container"></div>

            <div id="hint-area" class="hint-box">Conseil : Distribuez les cartes...</div>

            <div id="bj-p-wrapper"></div>

            <div id="bj-actions" style="display:flex; flex-wrap:wrap; margin-top:10px;">
                <button class="btn btn-action" id="btn-hit" onclick="hit()">Tirer</button>
                <button class="btn btn-action" id="btn-stand" onclick="stand()">Rester</button>
                <button class="btn btn-action" id="btn-double" onclick="double()">Doubler</button>
                <button class="btn btn-action" id="btn-split" onclick="split()">Split</button>
            </div>

            <button id="bj-next-btn" class="btn btn-gold hidden" onclick="bjInitHand()" style="margin-top:10px;">Main Suivante</button>
            <button class="btn" style="width:100%; color:var(--grey); margin-top:10px; background:none;" onclick="showAnalyse()">V√©rifier le compte</button>
        </div>
    </div>

    <div id="scr-count" class="screen">
        <button class="btn" style="color:var(--green); background:none; margin-bottom:20px;" onclick="stopCounting()">‚Üê RETOUR</button>
        <div class="glass" id="count-setup">
            <label>VITESSE (SEC/CARTE)</label>
            <input type="number" id="count-spd" value="1.5" step="0.1" style="width:100%; padding:10px; margin:10px 0; background:#222; color:white; border:1px solid #444;">
            <button class="btn btn-gold" style="background:var(--green)" onclick="runCounting()">D√©marrer</button>
        </div>
        <div id="count-run" class="hidden" style="text-align:center;">
            <div id="count-card-display" style="height:220px; width:150px; background:white; border-radius:12px; margin:20px auto; display:flex; align-items:center; justify-content:center; font-size:4.5rem; color:black; font-weight:bold; box-shadow:0 0 20px rgba(46, 204, 113, 0.2);">?</div>
            <button class="btn btn-action" onclick="showAnalyse()">V√âRIFIER LE COMPTE</button>
        </div>
    </div>

    <div id="modal-analyse" class="screen" style="position:fixed; top:0; left:0; background:rgba(0,0,0,0.95); height:100vh; z-index:9999; flex-direction:column; justify-content:center; align-items:center; display:none;">
        <h2 style="color:var(--gold);">ANALYSE HI-LO</h2>
        <div class="glass" style="text-align:center; width:80%;">
            <p>RUNNING COUNT</p>
            <div id="ana-rc" style="font-size:4rem; font-weight:bold; color:var(--gold);">0</div>
            <p>TRUE COUNT : <span id="ana-tc">0</span></p>
        </div>
        <button class="btn btn-gold" style="width:80%;" onclick="hideAnalyse()">RETOUR</button>
    </div>

    <script>
        // --- ETAT GLOBAL ---
        let deck = [];
        let rc = 0;
        let countInterval = null;
        let pHands = [];
        let dHand = [];
        let currIdx = 0;
        let isGameOver = false;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function initDeck(n=6) {
            const v = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const s = ['‚ô†','‚ô•','‚ô¶','‚ô£']; deck = [];
            for(let i=0; i<n; i++) for(let suit of s) for(let val of v) deck.push({v:val, s:suit});
            deck.sort(() => Math.random() - 0.5);
        }

        function updateRC(v) {
            if(['2','3','4','5','6'].includes(v)) rc++;
            if(['10','J','Q','K','A'].includes(v)) rc--;
            const info = document.getElementById('bj-deck-info');
            if(info) info.innerText = `DECK: ${(deck.length/52).toFixed(1)}`;
        }

        // --- COMPTAGE VITESSE ---
        function startCounting() { showScreen('scr-count'); document.getElementById('count-setup').classList.remove('hidden'); document.getElementById('count-run').classList.add('hidden'); }
        function stopCounting() { clearInterval(countInterval); showScreen('scr-home'); }
        function runCounting() {
            initDeck(6); rc = 0;
            document.getElementById('count-setup').classList.add('hidden');
            document.getElementById('count-run').classList.remove('hidden');
            const spd = parseFloat(document.getElementById('count-spd').value) * 1000;
            countInterval = setInterval(() => {
                if(deck.length === 0) { clearInterval(countInterval); return alert("Fin du sabot"); }
                const c = deck.pop();
                const el = document.getElementById('count-card-display');
                el.innerText = c.v; el.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black';
                updateRC(c.v);
            }, spd);
        }

        // --- BLACKJACK REEL ---
        function startBlackjack() {
            showScreen('scr-bj');
            initDeck(6); rc = 0;
            bjInitHand();
        }

        async function bjInitHand() {
            if(deck.length < 15) initDeck(6);
            pHands = [{ cards: [], status: 'play' }]; dHand = [];
            currIdx = 0; isGameOver = false;
            document.getElementById('bj-next-btn').classList.add('hidden');
            document.getElementById('bj-actions').classList.remove('hidden');
            document.getElementById('bj-d-score').innerText = "?";
            
            // S√©quence : P, D, P, D(cach√©)
            await dealTo('p', 0);
            await dealTo('d');
            await dealTo('p', 0);
            await dealTo('d');
            
            checkBlackjack();
            updateUI();
        }

        async function dealTo(target, idx=0) {
            return new Promise(res => {
                setTimeout(() => {
                    const c = deck.pop(); updateRC(c.v);
                    if(target === 'p') pHands[idx].cards.push(c); else dHand.push(c);
                    updateUI(); res();
                }, 500);
            });
        }

        function checkBlackjack() {
            const pVal = calc(pHands[0].cards);
            if(pVal === 21) {
                isGameOver = true;
                document.getElementById('hint-area').innerText = "BLACKJACK ! Vous gagnez imm√©diatement.";
                endGame();
            }
        }

        function updateUI() {
            const dDiv = document.getElementById('bj-d-hand'); dDiv.innerHTML = "";
            dHand.forEach((c, i) => {
                const card = document.createElement('div'); card.className = "mini-card";
                if(i === 1 && !isGameOver) { card.innerText = "?"; card.style.background = "#333"; }
                else { card.innerText = c.v; card.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black'; }
                dDiv.appendChild(card);
            });

            const pWrapper = document.getElementById('bj-p-wrapper'); pWrapper.innerHTML = "";
            pHands.forEach((h, i) => {
                const div = document.createElement('div');
                div.className = `glass ${i === currIdx && !isGameOver ? 'active-hand' : ''}`;
                div.innerHTML = `<div style="font-size:0.6rem;">MAIN ${i+1} - ${calc(h.cards)}</div><div class="hand-container" id="p-h-${i}"></div>`;
                pWrapper.appendChild(div);
                h.cards.forEach(c => {
                    const card = document.createElement('div'); card.className = "mini-card";
                    card.innerText = c.v; card.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black';
                    document.getElementById(`p-h-${i}`).appendChild(card);
                });
            });

            if(!isGameOver) provideHint();
        }

        function provideHint() {
            const h = pHands[currIdx];
            const pVal = calc(h.cards);
            const dVal = valToNum(dHand[0].v);
            let advice = "Tirez (Hit)";

            if(pVal >= 17) advice = "Restez (Stand)";
            else if(pVal >= 13 && dVal <= 6) advice = "Restez (Stand)";
            else if(pVal === 12 && dVal >= 4 && dVal <= 6) advice = "Restez (Stand)";
            else if(pVal === 11) advice = "Doublez !";
            
            document.getElementById('hint-area').innerText = `Conseil : ${advice}`;
            document.getElementById('btn-split').disabled = (h.cards.length !== 2 || h.cards[0].v !== h.cards[1].v);
            document.getElementById('btn-double').disabled = (h.cards.length !== 2);
        }

        function calc(h) {
            let s = 0, a = 0;
            h.forEach(c => { if(c.v === 'A') a++; else if(['J','Q','K','10'].includes(c.v)) s += 10; else s += parseInt(c.v); });
            for(let i=0; i<a; i++) s += (s + 11 <= 21) ? 11 : 1;
            return s;
        }

        function valToNum(v) {
            if(['J','Q','K','10'].includes(v)) return 10;
            if(v === 'A') return 11;
            return parseInt(v);
        }

        async function hit() { await dealTo('p', currIdx); if(calc(pHands[currIdx].cards) > 21) nextHand(); }
        async function double() { await dealTo('p', currIdx); nextHand(); }
        async function split() {
            const h = pHands[currIdx]; const c2 = h.cards.pop();
            pHands.splice(currIdx+1, 0, {cards:[c2], status:'play'});
            await dealTo('p', currIdx); updateUI();
        }
        function stand() { nextHand(); }

        function nextHand() {
            if(currIdx < pHands.length - 1) { currIdx++; updateUI(); }
            else { endGame(); }
        }

        async function endGame() {
            isGameOver = true;
            document.getElementById('bj-actions').classList.add('hidden');
            while(calc(dHand) < 17) await dealTo('d');
            document.getElementById('bj-d-score').innerText = calc(dHand);
            document.getElementById('bj-next-btn').classList.remove('hidden');
            updateUI();
        }

        // --- ANALYSE ---
        function showAnalyse() {
            const dr = Math.max(0.5, deck.length / 52);
            document.getElementById('ana-rc').innerText = (rc > 0 ? "+" : "") + rc;
            document.getElementById('ana-tc').innerText = Math.floor(rc / dr);
            document.getElementById('modal-analyse').style.display = 'flex';
        }
        function hideAnalyse() { document.getElementById('modal-analyse').style.display = 'none'; }
    </script>
</body>
</html>
