<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Casino & Papayoo</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --table: #2c3e50; /* Couleur tapis */
            --gold: #f1c40f;
            --white: #ecf0f1;
            --card-w: 70px;
            --card-h: 100px;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--white);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- NAVIGATION --- */
        .header {
            width: 100%; max-width: 500px;
            padding: 15px;
            display: flex; justify-content: space-between;
            box-sizing: border-box;
            background: #000;
        }
        
        .nav-btn {
            background: transparent; border: 1px solid var(--gold); 
            color: var(--gold); padding: 5px 15px; border-radius: 5px; cursor: pointer;
        }

        /* --- √âCRANS --- */
        .screen { width: 100%; max-width: 500px; display: none; padding: 10px; box-sizing: border-box; }
        .active { display: block; }

        /* --- ACCUEIL --- */
        .menu-card {
            background: #333; border-left: 5px solid var(--gold);
            padding: 20px; margin: 20px 0; border-radius: 8px; cursor: pointer;
            transition: 0.2s;
        }
        .menu-card:hover { background: #444; }

        /* --- BLACKJACK TABLE --- */
        .bj-table {
            background-color: #27ae60; /* Tapis vert classique pour bien voir les cartes */
            border: 8px solid #3e2723; /* Bordure bois */
            border-radius: 20px;
            padding: 20px;
            min-height: 400px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        .hand-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px; /* Espace entre les cartes */
            min-height: 110px;
        }

        .score-bubble {
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-bottom: 5px;
            text-align: center;
            width: fit-content;
            margin: 0 auto 5px auto;
        }

        /* --- CARTES --- */
        .card {
            width: var(--card-w);
            height: var(--card-h);
            background: white;
            border-radius: 6px;
            color: black;
            font-weight: bold;
            font-size: 1.2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
            position: relative;
            animation: deal 0.4s ease-out; /* Animation d'arriv√©e */
        }
        
        @keyframes deal { 
            from { transform: translateY(-50px) scale(0.5); opacity: 0; } 
            to { transform: translateY(0) scale(1); opacity: 1; } 
        }

        .suit { font-size: 1.5rem; }
        .red { color: #c0392b; }
        .black { color: #2c3e50; }

        /* Dos de carte */
        .card-back {
            background: repeating-linear-gradient(
                45deg,
                #c0392b,
                #c0392b 10px,
                #e74c3c 10px,
                #e74c3c 20px
            );
            border: 2px solid white;
            display: flex; align-items: center; justify-content: center;
        }
        .card-back::after {
            content: "BJ"; color: white; font-weight: bold; font-size: 1.5rem;
            background: rgba(0,0,0,0.3); padding: 5px; border-radius: 50%;
        }

        /* --- CONTR√îLES --- */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-action {
            padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer;
            color: white; text-transform: uppercase;
        }
        .btn-hit { background: #27ae60; }
        .btn-stand { background: #c0392b; }
        .btn-double { background: #f39c12; color: black; }
        .btn-split { background: #2980b9; }
        .btn-action:disabled { opacity: 0.3; cursor: not-allowed; background: #555; color: #aaa; }

        .hidden { display: none !important; }

        /* --- PAPAYOO (Intouch√©) --- */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #444; padding: 10px; text-align: center; }
        .p-input { width: 50px; padding: 5px; text-align: center; background: #333; color: white; border: none; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0; color:var(--gold);">GAMES</h2>
        <button class="nav-btn" onclick="goHome()">ACCUEIL</button>
    </div>

    <div id="home" class="screen active">
        <div class="menu-card" onclick="setupBlackjack()">
            <h2 style="margin:0; color:var(--gold);">üÉè BLACKJACK</h2>
            <p>Jeu classique. Decks configurables.</p>
        </div>
        <div class="menu-card" onclick="setupPapayoo()" style="border-color: #3498db;">
            <h2 style="margin:0; color: #3498db;">üé≠ PAPAYOO</h2>
            <p>Compteur de points.</p>
        </div>
    </div>

    <div id="bj-setup" class="screen">
        <h3>Configuration Blackjack</h3>
        <label>Nombre de Decks :</label>
        <select id="deck-count" style="width:100%; padding:10px; margin:10px 0; background:#333; color:white;">
            <option value="6">6 Decks (Standard)</option>
            <option value="1">1 Deck</option>
            <option value="2">2 Decks</option>
        </select>
        <button class="btn-action btn-hit" style="width:100%; margin-top:20px;" onclick="startBlackjack()">JOUER</button>
    </div>

    <div id="bj-game" class="screen">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <button class="nav-btn" onclick="startBlackjack()">NOUVELLE MAIN</button>
            <button class="nav-btn" style="border-color:#e74c3c; color:#e74c3c;" onclick="goHome()">QUITTER</button>
        </div>

        <div class="bj-table">
            <div>
                <div class="score-bubble">CROUPIER: <span id="d-score">?</span></div>
                <div id="d-hand" class="hand-area"></div>
            </div>

            <div id="game-msg" style="text-align:center; font-weight:bold; color:var(--gold); font-size:1.2rem; height:30px;"></div>

            <div>
                <div id="p-hand" class="hand-area"></div>
                <div class="score-bubble">JOUEUR: <span id="p-score">0</span></div>
            </div>
        </div>

        <div class="controls" id="controls">
            <button class="btn-action btn-hit" onclick="hit()">TIRER</button>
            <button class="btn-action btn-stand" onclick="stand()">RESTER</button>
            <button class="btn-action btn-double" id="btn-double" onclick="double()">DOUBLER</button>
            <button class="btn-action btn-split" id="btn-split" onclick="split()">SPLIT</button>
        </div>
    </div>

    <div id="papayoo" class="screen">
        <h3>Papayoo Tracker</h3>
        <div id="p-setup-area">
            <input type="text" class="p-name" placeholder="Joueur 1" style="width:100%; margin-bottom:5px; padding:10px;">
            <input type="text" class="p-name" placeholder="Joueur 2" style="width:100%; margin-bottom:5px; padding:10px;">
            <input type="text" class="p-name" placeholder="Joueur 3" style="width:100%; margin-bottom:5px; padding:10px;">
            <button class="btn-action btn-split" style="width:100%; margin-top:10px;" onclick="runPapayoo()">LANCER</button>
        </div>
        <div id="p-play-area" class="hidden">
            <button class="btn-action btn-double" style="width:100%;" onclick="rollColor()">üé≤ TIRER COULEUR</button>
            <div id="p-color-res" style="text-align:center; font-weight:bold; margin:10px; font-size:1.2rem;">--</div>
            <table id="p-table">
                <thead><tr id="p-head"></tr></thead>
                <tbody id="p-body"></tbody>
                <tfoot><tr id="p-foot"></tr></tfoot>
            </table>
            <button class="btn-action btn-hit" style="width:100%; margin-top:10px;" onclick="savePRound()">VALIDER MANCHE</button>
        </div>
    </div>

    <script>
        // --- NAVIGATION ---
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
        function goHome() { showScreen('home'); }
        function setupBlackjack() { showScreen('bj-setup'); }
        function setupPapayoo() { showScreen('papayoo'); }

        // --- BLACKJACK ENGINE ---
        let deck = [];
        let pHand = [];
        let dHand = [];
        let gameOver = false;

        function createDeck() {
            const n = parseInt(document.getElementById('deck-count').value);
            const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
            deck = [];
            for(let i=0; i<n; i++) {
                for(let s of suits) {
                    for(let r of ranks) {
                        deck.push({ r, s });
                    }
                }
            }
            // M√©lange
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        async function startBlackjack() {
            if(deck.length < 15) createDeck();
            
            showScreen('bj-game');
            pHand = [];
            dHand = [];
            gameOver = false;
            
            // UI Reset
            document.getElementById('p-hand').innerHTML = '';
            document.getElementById('d-hand').innerHTML = '';
            document.getElementById('game-msg').innerText = '';
            document.getElementById('controls').classList.add('hidden'); // On cache les boutons pendant la distrib
            updateScores();

            // Distribution anim√©e
            await dealCard('p', true);
            await dealCard('d', true); // Visible
            await dealCard('p', true);
            await dealCard('d', false); // Cach√©e

            // Fin distribution
            document.getElementById('controls').classList.remove('hidden');
            
            checkNaturalBJ();
            updateButtons();
        }

        function createCardDOM(card, isHidden) {
            const el = document.createElement('div');
            if(isHidden) {
                el.className = 'card card-back';
            } else {
                el.className = 'card';
                const isRed = (card.s === '‚ô•' || card.s === '‚ô¶');
                el.classList.add(isRed ? 'red' : 'black');
                
                el.innerHTML = `
                    <div style="font-size:1rem;">${card.r}</div>
                    <div class="suit">${card.s}</div>
                `;
            }
            return el;
        }

        async function dealCard(target, visible) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const c = deck.pop();
                    const el = createCardDOM(c, !visible);
                    
                    if(target === 'p') {
                        pHand.push(c);
                        document.getElementById('p-hand').appendChild(el);
                    } else {
                        dHand.push(c);
                        document.getElementById('d-hand').appendChild(el);
                    }
                    updateScores();
                    resolve();
                }, 400); // Vitesse distribution
            });
        }

        function getScore(hand) {
            let score = 0;
            let aces = 0;
            hand.forEach(c => {
                if(c.r === 'A') aces++;
                else if(['K','Q','J','10'].includes(c.r)) score += 10;
                else score += parseInt(c.r);
            });
            for(let i=0; i<aces; i++) {
                if(score + 11 <= 21) score += 11;
                else score += 1;
            }
            return score;
        }

        function updateScores() {
            document.getElementById('p-score').innerText = getScore(pHand);
            
            // Score Croupier : On montre seulement la 1√®re carte si le jeu est en cours
            if(dHand.length > 0) {
                if(!gameOver && dHand.length === 2) {
                    // Calcul savant pour n'afficher que la valeur de la carte visible
                    const c = dHand[0];
                    let val = 0;
                    if(c.r === 'A') val=11; else if(['K','Q','J','10'].includes(c.r)) val=10; else val=parseInt(c.r);
                    document.getElementById('d-score').innerText = val;
                } else {
                    document.getElementById('d-score').innerText = getScore(dHand);
                }
            }
        }

        function updateButtons() {
            if(gameOver) {
                document.getElementById('controls').classList.add('hidden');
                return;
            }
            // Double : Seulement si 2 cartes
            document.getElementById('btn-double').disabled = (pHand.length !== 2);
            
            // Split : Seulement si paire (valeur faciale stricte)
            const canSplit = (pHand.length === 2 && pHand[0].r === pHand[1].r);
            document.getElementById('btn-split').disabled = !canSplit;
        }

        function checkNaturalBJ() {
            if(getScore(pHand) === 21) {
                document.getElementById('game-msg').innerText = "BLACKJACK !";
                endGame();
            }
        }

        // Actions
        async function hit() {
            await dealCard('p', true);
            if(getScore(pHand) > 21) {
                document.getElementById('game-msg').innerText = "BUST !";
                endGame();
            } else {
                updateButtons(); // D√©sactive Double/Split apr√®s un hit
            }
        }

        async function double() {
            await dealCard('p', true);
            endGame(); // Apr√®s double, c'est fini pour le joueur
        }

        function stand() {
            endGame();
        }

        function split() {
            alert("Le Split n√©cessite une architecture multi-mains complexe. Pour cet entra√Ænement simple, cette option est d√©sactiv√©e.");
        }

        async function endGame() {
            gameOver = true;
            document.getElementById('controls').classList.add('hidden');

            // 1. R√©v√©ler la carte cach√©e du dealer
            const dealerContainer = document.getElementById('d-hand');
            const hiddenCardEl = dealerContainer.children[1];
            // On remplace le visuel
            const realCard = dHand[1];
            const newEl = createCardDOM(realCard, false);
            dealerContainer.replaceChild(newEl, hiddenCardEl);
            updateScores();

            // 2. Dealer joue si joueur pas bust
            if(getScore(pHand) <= 21) {
                while(getScore(dHand) < 17) {
                    await dealCard('d', true);
                }
            }

            // 3. R√©sultat
            const p = getScore(pHand);
            const d = getScore(dHand);
            let msg = "";

            if(p > 21) msg = "PERDU (Bust)";
            else if(d > 21) msg = "GAGN√â (Dealer Bust)";
            else if(p > d) msg = "GAGN√â";
            else if(p < d) msg = "PERDU";
            else msg = "√âGALIT√â (Push)";

            document.getElementById('game-msg').innerText = msg;
        }


        // --- PAPAYOO (Intouch√©) ---
        let pPlayers = [];
        function runPapayoo() {
            pPlayers = Array.from(document.querySelectorAll('.p-name'))
                .map(i => i.value.trim()).filter(n=>n)
                .map(n => ({name:n, scores:[], total:0}));
            if(pPlayers.length===0) return alert("Noms ?");
            document.getElementById('p-setup-area').classList.add('hidden');
            document.getElementById('p-play-area').classList.remove('hidden');
            renderPTable();
        }
        function renderPTable() {
            const h=document.getElementById('p-head'), b=document.getElementById('p-body'), f=document.getElementById('p-foot');
            h.innerHTML='<th>#</th>'+pPlayers.map(p=>`<th>${p.name}</th>`).join('');
            let r=''; 
            // Rows existing
            const rounds = pPlayers[0].scores.length;
            for(let i=0; i<rounds; i++) r+=`<tr><td>${i+1}</td>${pPlayers.map(p=>`<td>${p.scores[i]}</td>`).join('')}</tr>`;
            // Input row
            r+=`<tr><td>New</td>${pPlayers.map((p,i)=>`<td><input type="number" class="p-input" id="pi-${i}"></td>`).join('')}</tr>`;
            b.innerHTML=r;
            f.innerHTML='<td>TOT</td>'+pPlayers.map(p=>`<td>${p.total}</td>`).join('');
        }
        function savePRound() {
            const vals=pPlayers.map((_,i)=>parseInt(document.getElementById(`pi-${i}`).value)||0);
            if(vals.reduce((a,b)=>a+b,0)!==250) return alert("Total 250 requis");
            pPlayers.forEach((p,i)=>{p.scores.push(vals[i]); p.total+=vals[i]});
            renderPTable();
        }
        function rollColor() {
            const c=['‚ô•','‚ô¶','‚ô£','‚ô†'], cl=['#e74c3c','#e67e22','#27ae60','#2980b9'];
            const r=Math.floor(Math.random()*4);
            const el=document.getElementById('p-color-res'); el.innerText="7 de "+c[r]; el.style.color=cl[r];
        }

    </script>
</body>
</html>
