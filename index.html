<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Mastery Pro - Hub</title>
    <style>
        :root {
            --bg: #0a0a0a; --panel: #141414; --gold: #d4af37; --text: #ffffff;
            --green: #2ecc71; --red: #e74c3c; --blue: #3498db; --grey: #444;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        .screen { width: 100%; max-width: 500px; padding: 20px; margin: auto; box-sizing: border-box; display: none; min-height: 100vh; }
        .active { display: block; }

        /* --- UI COMPONENTS --- */
        .glass { background: var(--panel); border: 1px solid #333; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-nav { background: var(--grey); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        .btn-nav:hover { background: #555; }
        
        .btn-main { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-action { background: #222; color: white; border: 1px solid #444; flex: 1; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-action:disabled { opacity: 0.1; cursor: not-allowed; }

        /* --- CARDS --- */
        .hand-container { display: flex; justify-content: center; gap: 8px; min-height: 100px; margin: 15px 0; flex-wrap: wrap; }
        .card { 
            width: 60px; height: 90px; background: white; border-radius: 8px; color: black; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 5px 10px rgba(0,0,0,0.4); animation: deal 0.3s ease-out;
        }
        @keyframes deal { from { transform: translateY(-30px) rotate(10deg); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .card-hidden { background: #333; border: 2px solid #555; color: transparent; }

        /* --- MODALS --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
        .rules-content { text-align: left; font-size: 0.9rem; color: #ccc; line-height: 1.5; max-height: 70vh; overflow-y: auto; }

        /* --- PAPAYOO TABLE --- */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #333; padding: 8px; text-align: center; }
        th { color: var(--blue); background: #111; }
    </style>
</head>
<body>

    <div id="scr-home" class="screen active">
        <h1 style="text-align: center; color: var(--gold); letter-spacing: 6px; margin: 50px 0;">MASTERY PRO</h1>
        
        <div class="glass" onclick="goTo('scr-bj')" style="cursor:pointer; border-left: 5px solid var(--gold);">
            <h2 style="margin:0;">üÉè Blackjack Pro</h2>
            <p style="font-size:0.85rem; color:#888;">Simulateur r√©el : Split, Double, Assurance.</p>
        </div>

        <div class="glass" onclick="goTo('scr-count')" style="cursor:pointer; border-left: 5px solid var(--green);">
            <h2 style="margin:0;">‚è±Ô∏è Entra√Ænement Vitesse</h2>
            <p style="font-size:0.85rem; color:#888;">Compteur Hi-Lo avec arr√™t al√©atoire.</p>
        </div>

        <div class="glass" onclick="goTo('scr-papayoo')" style="cursor:pointer; border-left: 5px solid var(--blue);">
            <h2 style="margin:0;">üé≠ Papayoo</h2>
            <p style="font-size:0.85rem; color:#888;">Compteur de points classique.</p>
        </div>
    </div>

    <div id="scr-bj" class="screen">
        <div class="nav-bar">
            <button class="btn-nav" onclick="goHome()">üè† ACCUEIL</button>
            <button class="btn-nav" onclick="showRules('bj')">‚ÑπÔ∏è R√àGLES</button>
            <button class="btn-nav" style="color:var(--red)" onclick="startBlackjack()">üîÑ RESET</button>
        </div>

        <div id="bj-game-zone">
            <div style="text-align:center; font-size:0.8rem; color:#888;">DEALER <span id="bj-d-val" style="color:var(--gold)">--</span></div>
            <div id="bj-d-hand" class="hand-container"></div>

            <div id="bj-advice" style="text-align:center; color:var(--gold); font-size:0.8rem; height:20px; margin-bottom:10px;"></div>

            <div id="bj-p-hands"></div>

            <div id="bj-actions" style="display:flex; gap:5px; margin-top:20px;">
                <button class="btn-action" id="btn-hit" onclick="hit()">TIRER</button>
                <button class="btn-action" id="btn-stand" onclick="stand()">RESTER</button>
                <button class="btn-action" id="btn-double" onclick="double()">DOUBLER</button>
                <button class="btn-action" id="btn-split" onclick="split()">SPLIT</button>
            </div>
            
            <button id="btn-next" class="btn-main btn-gold hidden" onclick="bjNewHand()" style="margin-top:15px;">MAIN SUIVANTE</button>
            <button class="btn-main" style="background:none; color:#555; margin-top:10px;" onclick="checkCount()">V√âRIFIER LE COMPTE</button>
        </div>
    </div>

    <div id="scr-count" class="screen">
        <div class="nav-bar">
            <button class="btn-nav" onclick="goHome()">üè† ACCUEIL</button>
            <button class="btn-nav" onclick="showRules('speed')">‚ÑπÔ∏è R√àGLES</button>
        </div>

        <div class="glass" id="speed-setup">
            <label style="font-size:0.8rem;">VITESSE (SEC/CARTE)</label>
            <input type="number" id="speed-val" value="1.5" step="0.1" style="width:100%; padding:12px; background:#222; color:white; border:1px solid #444; border-radius:8px; margin:10px 0;">
            <div style="display:flex; justify-content: space-between; align-items:center; margin-top:10px;">
                <span>Arr√™t Al√©atoire üé≤</span>
                <input type="checkbox" id="speed-random" checked>
            </div>
            <button class="btn-main btn-gold" style="margin-top:20px;" onclick="runSpeed()">D√âMARRER</button>
        </div>

        <div id="speed-run" class="hidden" style="text-align:center;">
            <div id="speed-card" style="height:250px; width:170px; background:white; border-radius:15px; margin:30px auto; display:flex; align-items:center; justify-content:center; font-size:5rem; color:black; font-weight:bold; box-shadow:0 0 30px rgba(46,204,113,0.3);">?</div>
            <div id="speed-hint" style="color:var(--green); font-weight:bold; margin-bottom:15px; height:20px;"></div>
            <button class="btn-main btn-gold" onclick="checkCount()">V√âRIFIER LE COMPTE</button>
        </div>
    </div>

    <div id="scr-papayoo" class="screen">
        <div class="nav-bar">
            <button class="btn-nav" onclick="goHome()">üè† ACCUEIL</button>
        </div>
        <div class="glass">
            <h3 style="color:var(--blue); margin:0;">üé≠ Papayoo Tracker</h3>
            <table id="p-table">
                <thead><tr id="p-head"><th>Rd</th></tr></thead>
                <tbody id="p-body"></tbody>
                <tfoot><tr id="p-foot"><td>+</td></tr></tfoot>
            </table>
            <button class="btn-main btn-gold" style="background:var(--blue); color:white; margin-top:10px;" onclick="alert('Ajoutez vos joueurs dans le code ou via un menu d√©di√©')">Actions Papayoo</button>
        </div>
    </div>

    <div id="modal-rules" class="modal">
        <h2 id="rules-title" style="color:var(--gold);">R√àGLES</h2>
        <div id="rules-text" class="rules-content glass"></div>
        <button class="btn-main btn-gold" onclick="closeModal('modal-rules')">COMPRIS</button>
    </div>

    <div id="modal-ana" class="modal">
        <h2 style="color:var(--gold);">COMPTE HI-LO</h2>
        <div class="glass" style="text-align:center; width:80%;">
            <p>RUNNING COUNT</p>
            <div id="ana-rc" style="font-size:4rem; font-weight:bold; color:var(--gold);">0</div>
            <p>TRUE COUNT (SABOT)</p>
            <div id="ana-tc" style="font-size:1.5rem; color:#888;">0</div>
        </div>
        <button class="btn-main btn-gold" style="width:80%;" onclick="closeModal('modal-ana')">RETOUR AU JEU</button>
    </div>

    <script>
        // --- LOGIQUE CORE ---
        let deck = [];
        let rc = 0;
        let timer = null;
        let pHand = []; // Tableau de mains pour le split
        let dHand = [];
        let curIdx = 0;
        let over = false;

        const goTo = (id) => {
            stopAll();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-bj') startBlackjack();
        };

        const goHome = () => goTo('scr-home');

        const stopAll = () => {
            clearInterval(timer);
            timer = null;
            document.getElementById('modal-ana').style.display = 'none';
            document.getElementById('modal-rules').style.display = 'none';
        };

        const initDeck = () => {
            const v = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const s = ['‚ô†','‚ô•','‚ô¶','‚ô£']; deck = [];
            for(let i=0; i<6; i++) for(let suit of s) for(let val of v) deck.push({v:val, s:suit});
            deck.sort(() => Math.random() - 0.5);
            rc = 0;
        };

        const updateRC = (v) => {
            if(['2','3','4','5','6'].includes(v)) rc++;
            if(['10','J','Q','K','A'].includes(v)) rc--;
        };

        // --- BLACKJACK ---
        function startBlackjack() {
            initDeck();
            bjNewHand();
        }

        async function bjNewHand() {
            if(deck.length < 20) initDeck();
            pHand = [{ cards: [], status: 'play' }];
            dHand = []; curIdx = 0; over = false;
            document.getElementById('btn-next').classList.add('hidden');
            document.getElementById('bj-actions').classList.remove('hidden');
            document.getElementById('bj-d-val').innerText = "?";
            
            await dealTo('p', 0);
            await dealTo('d'); // Visible
            await dealTo('p', 0);
            await dealTo('d'); // Cach√©
            
            if(calc(pHand[0].cards) === 21) {
                over = true;
                document.getElementById('bj-advice').innerText = "BLACKJACK NATUREL !";
                finishGame();
            }
            updateBJUI();
        }

        async function dealTo(target, idx=0) {
            return new Promise(res => {
                setTimeout(() => {
                    const c = deck.pop();
                    updateRC(c.v);
                    if(target === 'p') pHand[idx].cards.push(c); else dHand.push(c);
                    updateBJUI();
                    res();
                }, 400);
            });
        }

        function updateBJUI() {
            const dDiv = document.getElementById('bj-d-hand'); dDiv.innerHTML = "";
            dHand.forEach((c, i) => {
                const card = document.createElement('div');
                card.className = (i === 1 && !over) ? "card card-hidden" : "card";
                card.innerText = c.v;
                if(c.s === '‚ô•' || c.s === '‚ô¶') card.style.color = "var(--red)";
                dDiv.appendChild(card);
            });

            const pDiv = document.getElementById('bj-p-hands'); pDiv.innerHTML = "";
            pHand.forEach((h, i) => {
                const wrap = document.createElement('div');
                wrap.className = `glass ${i === curIdx && !over ? 'active-hand' : ''}`;
                wrap.style.border = (i === curIdx && !over) ? "1px solid var(--gold)" : "1px solid #333";
                wrap.innerHTML = `<div style="font-size:0.7rem;">MAIN ${i+1} (${calc(h.cards)})</div><div class="hand-container" id="p-cards-${i}"></div>`;
                pDiv.appendChild(wrap);
                h.cards.forEach(c => {
                    const card = document.createElement('div'); card.className = "card"; card.innerText = c.v;
                    if(c.s === '‚ô•' || c.s === '‚ô¶') card.style.color = "var(--red)";
                    document.getElementById(`p-cards-${i}`).appendChild(card);
                });
            });

            // Logic des boutons
            const cur = pHand[curIdx];
            document.getElementById('btn-split').style.display = (cur.cards.length === 2 && cur.cards[0].v === cur.cards[1].v) ? "block" : "none";
            document.getElementById('btn-double').style.display = (cur.cards.length === 2) ? "block" : "none";
        }

        function calc(h) {
            let s = 0, a = 0;
            h.forEach(c => { if(c.v === 'A') a++; else if(['J','Q','K','10'].includes(c.v)) s += 10; else s += parseInt(c.v); });
            for(let i=0; i<a; i++) s += (s + 11 <= 21) ? 11 : 1;
            return s;
        }

        async function hit() { await dealTo('p', curIdx); if(calc(pHand[curIdx].cards) >= 21) nextHand(); }
        async function double() { await dealTo('p', curIdx); nextHand(); }
        async function split() {
            const c = pHand[curIdx].cards.pop();
            pHand.splice(curIdx + 1, 0, { cards: [c], status: 'play' });
            await dealTo('p', curIdx);
            updateBJUI();
        }
        function stand() { nextHand(); }
        function nextHand() { if(curIdx < pHand.length - 1) { curIdx++; updateBJUI(); } else { finishGame(); } }

        async function finishGame() {
            over = true;
            while(calc(dHand) < 17) await dealTo('d');
            document.getElementById('bj-d-val').innerText = calc(dHand);
            document.getElementById('bj-actions').classList.add('hidden');
            document.getElementById('btn-next').classList.remove('hidden');
            updateBJUI();
        }

        // --- VITESSE ---
        function runSpeed() {
            initDeck();
            document.getElementById('speed-setup').classList.add('hidden');
            document.getElementById('speed-run').classList.remove('hidden');
            const spd = parseFloat(document.getElementById('speed-val').value) * 1000;
            
            timer = setInterval(() => {
                const c = deck.pop();
                updateRC(c.v);
                const el = document.getElementById('speed-card');
                el.innerText = c.v;
                el.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black';
                
                // Hint
                let hint = "0";
                if(['2','3','4','5','6'].includes(c.v)) hint = "+1";
                if(['10','J','Q','K','A'].includes(c.v)) hint = "-1";
                document.getElementById('speed-hint').innerText = hint;

                if(document.getElementById('speed-random').checked && Math.random() < 0.1) {
                    clearInterval(timer);
                    document.getElementById('speed-hint').innerText = "ARR√äT ! V√âRIFIE LE COMPTE";
                }
            }, spd);
        }

        // --- UTILS ---
        function checkCount() {
            clearInterval(timer); // Arr√™te le d√©filement
            const dr = Math.max(0.5, deck.length / 52);
            document.getElementById('ana-rc').innerText = (rc > 0 ? "+" : "") + rc;
            document.getElementById('ana-tc').innerText = Math.floor(rc / dr);
            document.getElementById('modal-ana').style.display = 'flex';
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        function showRules(type) {
            const m = document.getElementById('modal-rules');
            const t = document.getElementById('rules-text');
            if(type === 'bj') {
                t.innerHTML = "‚Ä¢ Le croupier s'arr√™te √† 17.<br>‚Ä¢ Blackjack paye 3 pour 2.<br>‚Ä¢ Double possible sur les 2 premi√®res cartes.<br>‚Ä¢ Split possible si paire.<br>‚Ä¢ Hi-Lo : 2-6 (+1), 7-9 (0), 10-A (-1).";
            } else {
                t.innerHTML = "‚Ä¢ Les cartes d√©filent automatiquement.<br>‚Ä¢ Comptez mentalement en utilisant le syst√®me Hi-Lo.<br>‚Ä¢ Si l'arr√™t al√©atoire est activ√©, le jeu se fige pour vous tester.<br>‚Ä¢ Appuyez sur V√©rifier pour comparer votre score.";
            }
            m.style.display = 'flex';
        }
    </script>
</body>
</html>
