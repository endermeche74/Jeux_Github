<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Mastery Pro - Hub Edition</title>
    <style>
        :root {
            --bg: #0a0a0a; --panel: #141414; --gold: #d4af37; --text: #ffffff;
            --green: #2ecc71; --red: #e74c3c; --blue: #3498db; --grey: #2a2a2a;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        .screen { width: 100%; max-width: 500px; padding: 20px; margin: auto; box-sizing: border-box; display: none; min-height: 100vh; }
        .active { display: block; }

        /* NAV & UI */
        .nav-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .glass { background: var(--panel); border: 1px solid #333; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .btn-nav { background: var(--grey); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.75rem; }
        .btn-main { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.9rem; margin-top: 10px; transition: 0.2s; }

        .btn-gold { background: var(--gold); color: black; }
        .btn-action { background: #222; color: white; border: 1px solid #444; flex: 1; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.7rem; }
        .btn-action:disabled { opacity: 0.15; pointer-events: none; }

        /* CARDS */
        .hand-container { display: flex; justify-content: center; gap: 8px; min-height: 100px; margin: 10px 0; flex-wrap: wrap; }
        .card { 
            width: 60px; height: 90px; background: white; border-radius: 8px; color: black; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 5px 10px rgba(0,0,0,0.4); animation: deal 0.3s ease-out; position: relative;
        }
        @keyframes deal { from { transform: translateY(-40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .card-back { background: #333; border: 2px solid #555; color: transparent; }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 25px; box-sizing: border-box; }
        .modal-content { max-width: 400px; width: 100%; }

        /* PAPAYOO */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        th, td { border: 1px solid #333; padding: 8px; text-align: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="scr-home" class="screen active">
        <h1 style="text-align: center; color: var(--gold); letter-spacing: 8px; margin: 60px 0;">MASTERY PRO</h1>
        
        <div class="glass" onclick="switchMode('scr-bj')" style="cursor:pointer; border-left: 5px solid var(--gold);">
            <h2 style="margin:0;">üÉè Blackjack Pro</h2>
            <p style="color:#888; font-size:0.85rem;">Split, Double, Assurance & Strat√©gie.</p>
        </div>

        <div class="glass" onclick="switchMode('scr-speed')" style="cursor:pointer; border-left: 5px solid var(--green);">
            <h2 style="margin:0;">‚è±Ô∏è Comptage Vitesse</h2>
            <p style="color:#888; font-size:0.85rem;">Entra√Ænement Hi-Lo avec arr√™t al√©atoire.</p>
        </div>

        <div class="glass" onclick="switchMode('scr-pap')" style="cursor:pointer; border-left: 5px solid var(--blue);">
            <h2 style="margin:0;">üé≠ Papayoo</h2>
            <p style="color:#888; font-size:0.85rem;">Compteur de points classique.</p>
        </div>
    </div>

    <div id="scr-bj" class="screen">
        <div class="nav-header">
            <button class="btn-nav" onclick="goHome()">üè† HOME</button>
            <button class="btn-nav" onclick="openRules('bj')">‚ÑπÔ∏è R√àGLES</button>
            <button class="btn-nav" style="color:var(--red)" onclick="initBJ()">üîÑ NOUVEAU</button>
        </div>

        <div id="bj-dealer-zone">
            <div style="text-align:center; font-size:0.75rem; color:#888;">DEALER <span id="bj-d-val" class="hidden"></span></div>
            <div id="bj-d-hand" class="hand-container"></div>
        </div>

        <div id="bj-advice" style="text-align:center; color:var(--gold); font-size:0.8rem; min-height:20px; margin:10px 0;"></div>

        <div id="bj-player-zone"></div>

        <div id="bj-controls" class="glass" style="display:flex; gap:5px; margin-top:15px;">
            <button class="btn-action" id="btn-hit" onclick="bjHit()">TIRER</button>
            <button class="btn-action" id="btn-stand" onclick="bjStand()">RESTER</button>
            <button class="btn-action" id="btn-double" onclick="bjDouble()">DOUBLER</button>
            <button class="btn-action" id="btn-split" onclick="bjSplit()">SPLIT</button>
        </div>

        <button id="btn-next-hand" class="btn-main btn-gold hidden" onclick="startNewHand()">MAIN SUIVANTE</button>
        <button class="btn-main" style="background:transparent; color:#555;" onclick="showAnalysis()">ANALYSE COMPTE</button>
    </div>

    <div id="scr-speed" class="screen">
        <div class="nav-header">
            <button class="btn-nav" onclick="goHome()">üè† HOME</button>
            <button class="btn-nav" onclick="openRules('speed')">‚ÑπÔ∏è R√àGLES</button>
        </div>

        <div id="speed-setup" class="glass">
            <label style="font-size:0.8rem;">VITESSE (SEC/CARTE)</label>
            <input type="number" id="speed-sec" value="1.5" step="0.1" style="width:100%; padding:12px; background:#222; color:white; border:1px solid #444; border-radius:8px; margin:10px 0;">
            <div style="display:flex; justify-content:space-between; margin:15px 0;">
                <span>Arr√™t Al√©atoire</span>
                <input type="checkbox" id="speed-rand-stop" checked>
            </div>
            <button class="btn-main btn-gold" onclick="startSpeed()">D√âMARRER</button>
        </div>

        <div id="speed-play" class="hidden" style="text-align:center;">
            <div id="speed-card-box" style="height:260px; width:180px; background:white; border-radius:15px; margin:40px auto; display:flex; align-items:center; justify-content:center; font-size:6rem; color:black; font-weight:bold; box-shadow: 0 0 30px rgba(46,204,113,0.4);">?</div>
            <div id="speed-val-hint" style="color:var(--green); font-weight:bold; height:20px; margin-bottom:20px;"></div>
            <button class="btn-main btn-gold" onclick="showAnalysis()">V√âRIFIER LE COMPTE</button>
        </div>
    </div>

    <div id="scr-pap" class="screen">
        <div class="nav-header">
            <button class="btn-nav" onclick="goHome()">üè† HOME</button>
        </div>
        <div class="glass">
            <h3 style="color:var(--blue); margin-top:0;">üé≠ Papayoo Points</h3>
            <table id="pap-table">
                <thead><tr id="pap-head"><th>Rd</th></tr></thead>
                <tbody id="pap-body"></tbody>
                <tfoot><tr id="pap-foot"><td>TOT</td></tr></tfoot>
            </table>
        </div>
    </div>

    <div id="mod-rules" class="modal">
        <div class="modal-content">
            <h2 id="mod-rules-title" style="color:var(--gold); border-bottom: 1px solid #333; padding-bottom: 10px;">R√àGLES</h2>
            <div id="mod-rules-text" class="glass" style="font-size:0.85rem; line-height:1.6; color:#ccc; max-height:60vh; overflow-y:auto;"></div>
            <button class="btn-main btn-gold" onclick="closeModal('mod-rules')">FERMER</button>
        </div>
    </div>

    <div id="mod-ana" class="modal">
        <div class="modal-content" style="text-align:center;">
            <h2 style="color:var(--gold);">V√âRIFICATION</h2>
            <div class="glass">
                <p style="color:#888; margin:0;">RUNNING COUNT</p>
                <div id="ana-rc" style="font-size:5rem; font-weight:bold; color:var(--gold);">0</div>
                <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
                <p style="color:#888; margin:0;">TRUE COUNT</p>
                <div id="ana-tc" style="font-size:2rem; font-weight:bold;">0</div>
            </div>
            <button class="btn-main btn-gold" onclick="closeModal('mod-ana')">REPRENDRE</button>
        </div>
    </div>

    <script>
        let deck = [], rc = 0, speedTimer = null;
        let bjHands = [], bjDealer = [], bjIdx = 0, bjOver = false;

        // --- NAVIGATION ---
        function switchMode(id) {
            stopAllLogic();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-bj') initBJ();
        }

        function goHome() { switchMode('scr-home'); }

        function stopAllLogic() {
            clearInterval(speedTimer);
            speedTimer = null;
            closeModal('mod-ana');
            closeModal('mod-rules');
        }

        // --- DECK LOGIC ---
        function buildDeck() {
            const v = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const s = ['‚ô†','‚ô•','‚ô¶','‚ô£']; deck = [];
            for(let i=0; i<6; i++) for(let suit of s) for(let val of v) deck.push({v:val, s:suit});
            deck.sort(() => Math.random() - 0.5);
            rc = 0;
        }

        function updateHiLo(cardValue) {
            if(['2','3','4','5','6'].includes(cardValue)) rc++;
            if(['10','J','Q','K','A'].includes(cardValue)) rc--;
        }

        // --- BLACKJACK GAME ---
        function initBJ() {
            buildDeck();
            startNewHand();
        }

        async function startNewHand() {
            if(deck.length < 20) buildDeck();
            bjHands = [{ cards: [], status: 'play' }];
            bjDealer = []; bjIdx = 0; bjOver = false;
            
            document.getElementById('btn-next-hand').classList.add('hidden');
            document.getElementById('bj-controls').classList.remove('hidden');
            document.getElementById('bj-d-val').classList.add('hidden');
            document.getElementById('bj-advice').innerText = "";

            await dealBJ('p', 0);
            await dealBJ('d'); // Visible
            await dealBJ('p', 0);
            await dealBJ('d'); // Hidden
            
            checkNaturalBJ();
            updateBJUI();
        }

        async function dealBJ(target, idx=0) {
            return new Promise(res => {
                setTimeout(() => {
                    const c = deck.pop();
                    updateHiLo(c.v);
                    if(target === 'p') bjHands[idx].cards.push(c);
                    else bjDealer.push(c);
                    updateBJUI();
                    res();
                }, 400);
            });
        }

        function checkNaturalBJ() {
            if(calc(bjHands[0].cards) === 21) {
                bjOver = true;
                finishDealer();
            }
        }

        function updateBJUI() {
            const dZone = document.getElementById('bj-d-hand'); dZone.innerHTML = "";
            bjDealer.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = (i === 1 && !bjOver) ? "card card-back" : "card";
                div.innerText = c.v;
                if(c.s === '‚ô•' || c.s === '‚ô¶') div.style.color = "var(--red)";
                dZone.appendChild(div);
            });

            const pZone = document.getElementById('bj-player-zone'); pZone.innerHTML = "";
            bjHands.forEach((h, i) => {
                const glass = document.createElement('div');
                glass.className = "glass";
                if(i === bjIdx && !bjOver) glass.style.borderColor = "var(--gold)";
                glass.innerHTML = `<div style="font-size:0.7rem;">MAIN ${i+1} (${calc(h.cards)})</div><div class="hand-container" id="p-hand-${i}"></div>`;
                pZone.appendChild(glass);
                h.cards.forEach(c => {
                    const div = document.createElement('div'); div.className = "card"; div.innerText = c.v;
                    if(c.s === '‚ô•' || c.s === '‚ô¶') div.style.color = "var(--red)";
                    document.getElementById(`p-hand-${i}`).appendChild(div);
                });
            });

            const cur = bjHands[bjIdx];
            document.getElementById('btn-split').disabled = !(cur.cards.length === 2 && cur.cards[0].v === cur.cards[1].v);
            document.getElementById('btn-double').disabled = (cur.cards.length !== 2);
            if(!bjOver) getAdvice();
        }

        function calc(h) {
            let s = 0, a = 0;
            h.forEach(c => { if(c.v === 'A') a++; else if(['J','Q','K','10'].includes(c.v)) s += 10; else s += parseInt(c.v); });
            for(let i=0; i<a; i++) s += (s + 11 <= 21) ? 11 : 1;
            return s;
        }

        function getAdvice() {
            const p = calc(bjHands[bjIdx].cards), d = valToNum(bjDealer[0].v), el = document.getElementById('bj-advice');
            let adv = "Tirer (Hit)";
            if(p >= 17) adv = "Rester (Stand)";
            else if(p >= 13 && d <= 6) adv = "Rester (Stand)";
            else if(p === 12 && (d >= 4 && d <= 6)) adv = "Rester (Stand)";
            else if(p === 11) adv = "Doubler (Double)";
            el.innerText = `Conseil Strat√©gique: ${adv}`;
        }

        function valToNum(v) { return (['J','Q','K','10'].includes(v)) ? 10 : (v === 'A' ? 11 : parseInt(v)); }

        async function bjHit() { await dealBJ('p', bjIdx); if(calc(bjHands[bjIdx].cards) >= 21) bjNext(); }
        async function bjDouble() { await dealBJ('p', bjIdx); bjNext(); }
        async function bjSplit() {
            const c = bjHands[bjIdx].cards.pop();
            bjHands.splice(bjIdx + 1, 0, { cards: [c], status: 'play' });
            await dealBJ('p', bjIdx);
            updateBJUI();
        }
        function bjStand() { bjNext(); }
        function bjNext() { if(bjIdx < bjHands.length - 1) { bjIdx++; updateBJUI(); } else { finishDealer(); } }

        async function finishDealer() {
            bjOver = true;
            document.getElementById('bj-controls').classList.add('hidden');
            while(calc(bjDealer) < 17) await dealBJ('d');
            document.getElementById('bj-d-val').innerText = calc(bjDealer);
            document.getElementById('bj-d-val').classList.remove('hidden');
            document.getElementById('btn-next-hand').classList.remove('hidden');
            updateBJUI();
        }

        // --- SPEED COUNT ---
        function startSpeed() {
            buildDeck();
            document.getElementById('speed-setup').classList.add('hidden');
            document.getElementById('speed-play').classList.remove('hidden');
            const spd = parseFloat(document.getElementById('speed-sec').value) * 1000;
            
            speedTimer = setInterval(() => {
                const c = deck.pop();
                updateHiLo(c.v);
                const box = document.getElementById('speed-card-box');
                box.innerText = c.v; box.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black';
                
                let hint = "0";
                if(['2','3','4','5','6'].includes(c.v)) hint = "+1";
                if(['10','J','Q','K','A'].includes(c.v)) hint = "-1";
                document.getElementById('speed-val-hint').innerText = hint;

                if(document.getElementById('speed-rand-stop').checked && Math.random() < 0.12) {
                    clearInterval(speedTimer);
                    document.getElementById('speed-val-hint').innerText = "ARR√äT AL√âATOIRE !";
                }
            }, spd);
        }

        // --- GLOBALS ---
        function showAnalysis() {
            clearInterval(speedTimer);
            const dr = Math.max(0.5, deck.length / 52);
            document.getElementById('ana-rc').innerText = (rc > 0 ? "+" : "") + rc;
            document.getElementById('ana-tc').innerText = Math.floor(rc / dr);
            document.getElementById('mod-ana').style.display = 'flex';
        }

        function openRules(type) {
            const t = document.getElementById('mod-rules-text'), h = document.getElementById('mod-rules-title');
            if(type === 'bj') {
                h.innerText = "R√®gles Blackjack";
                t.innerHTML = "‚Ä¢ Dealer Stand on 17.<br>‚Ä¢ Blackjack paye 3:2.<br>‚Ä¢ Double sur n'importe quelles 2 cartes.<br>‚Ä¢ Split illimit√© sur paires.<br>‚Ä¢ Hi-Lo: 2-6 (+1), 7-9 (0), 10-A (-1).";
            } else {
                h.innerText = "R√®gles Comptage";
                t.innerHTML = "‚Ä¢ Entra√Ænez-vous √† garder le compte Hi-Lo.<br>‚Ä¢ L'arr√™t al√©atoire teste votre m√©moire.<br>‚Ä¢ True Count = Running Count / Sabots restants.";
            }
            document.getElementById('mod-rules').style.display = 'flex';
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
