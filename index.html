<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Mastery Pro - Blackjack & Counting</title>
    <style>
        :root {
            --bg: #0d0d0d; --panel: #1a1a1a; --gold: #c5a059; --text: #e0e0e0;
            --green: #27ae60; --red: #c0392b; --blue: #2980b9; --grey: #444;
        }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        .screen { width: 100%; max-width: 500px; padding: 15px; margin: auto; box-sizing: border-box; display: none; min-height: 100vh; }
        .active { display: block; }
        .hidden { display: none !important; }

        /* NAV BAR */
        .top-nav { display: flex; justify-content: space-between; padding: 10px; background: #000; border-bottom: 1px solid #333; }
        .nav-btn { background: none; border: 1px solid var(--grey); color: var(--text); padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
        .nav-btn:hover { border-color: var(--gold); }

        /* UI COMPONENTS */
        .glass { background: var(--panel); border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: black; width: 100%; margin-top: 10px; }
        .btn-action { background: #333; color: white; flex: 1; margin: 3px; border: 1px solid #555; }
        .btn-action:disabled { opacity: 0.2; pointer-events: none; }

        /* CARDS */
        .hand-container { display: flex; justify-content: center; gap: 5px; min-height: 90px; margin: 10px 0; flex-wrap: wrap; }
        .mini-card { 
            width: 55px; height: 80px; background: white; border-radius: 6px; color: black; 
            display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5); border: 1px solid #ccc;
        }
        .active-hand { border: 2px solid var(--gold); background: rgba(197, 160, 89, 0.1); border-radius: 8px; }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="nav-bar" class="top-nav hidden">
        <button class="nav-btn" onclick="exitToHome()">üè† <span>Home</span></button>
        <button class="nav-btn" onclick="showRules()">‚ÑπÔ∏è <span>R√®gles</span></button>
        <button class="nav-btn" style="color:var(--red)" onclick="resetCurrentGame()">üóëÔ∏è <span>Reset</span></button>
    </div>

    <div id="scr-home" class="screen active">
        <h1 style="text-align: center; color: var(--gold); letter-spacing: 6px; margin: 60px 0 30px;">MASTERY PRO</h1>
        <p style="text-align:center; color: var(--grey); margin-bottom: 40px;">ENTRA√éNEMENT √âLITE BLACKJACK</p>
        
        <div class="glass" onclick="goToGame('bj')" style="cursor:pointer; border-left: 5px solid var(--gold);">
            <h3 style="margin:0;">üÉè Blackjack R√©el</h3>
            <p style="font-size:0.8rem; color:var(--grey);">R√®gles casino, multi-split et aide strat√©gique.</p>
        </div>

        <div class="glass" onclick="goToGame('count')" style="cursor:pointer; border-left: 5px solid var(--green);">
            <h3 style="margin:0;">‚è±Ô∏è Comptage Vitesse</h3>
            <p style="font-size:0.8rem; color:var(--grey);">D√©filement auto avec arr√™ts de test al√©atoires.</p>
        </div>
    </div>

    <div id="scr-bj" class="screen">
        <div style="text-align:center; font-size:0.7rem; color:var(--grey);">DEALER <span id="bj-d-score" style="color:var(--gold)">--</span></div>
        <div id="bj-d-hand" class="hand-container"></div>

        <div id="hint-area" style="text-align:center; color:var(--gold); font-size:0.8rem; margin:10px; font-weight:bold; min-height:1.2em;"></div>

        <div id="bj-p-wrapper"></div>

        <div id="bj-actions" class="hidden" style="display:flex; flex-wrap:wrap;">
            <button class="btn btn-action" id="btn-hit" onclick="hit()">Tirer</button>
            <button class="btn btn-action" id="btn-stand" onclick="stand()">Rester</button>
            <button class="btn btn-action" id="btn-double" onclick="double()">Doubler</button>
            <button class="btn btn-action" id="btn-split" onclick="split()">Split</button>
        </div>

        <button id="bj-next-btn" class="btn btn-gold hidden" onclick="bjNewHand()">Main Suivante</button>
        <button class="btn btn-action" style="width:100%; margin-top:20px;" onclick="showAnalyse()">Analyse du compte</button>
    </div>

    <div id="scr-count" class="screen">
        <div class="glass" id="count-setup">
            <h2 style="color:var(--green); margin-top:0;">Param√®tres</h2>
            <label style="font-size:0.8rem;">VITESSE (SEC/CARTE)</label>
            <input type="number" id="count-spd" value="1.5" step="0.1" style="width:100%; padding:10px; margin:10px 0; background:#222; color:white; border:1px solid #444; border-radius:5px;">
            <div style="display:flex; justify-content: space-between; align-items:center; margin:15px 0;">
                <span style="font-size:0.9rem;">Arr√™t Al√©atoire (Test)</span>
                <input type="checkbox" id="count-rng" style="width:20px; height:20px;">
            </div>
            <button class="btn btn-gold" style="background:var(--green); color:white;" onclick="runCounting()">D√©marrer l'entra√Ænement</button>
        </div>

        <div id="count-run" class="hidden" style="text-align:center;">
            <div id="count-card-display" style="height:250px; width:170px; background:white; border-radius:12px; margin:20px auto; display:flex; align-items:center; justify-content:center; font-size:5rem; color:black; font-weight:bold; box-shadow:0 0 30px rgba(39, 174, 96, 0.3);">?</div>
            <div id="count-msg" style="color:var(--gold); font-weight:bold; margin-bottom:15px;"></div>
            <button id="count-check-btn" class="btn btn-action" style="width:100%;" onclick="showAnalyse()">V√âRIFIER LE COMPTE</button>
            <button id="count-resume-btn" class="btn btn-gold hidden" onclick="resumeCounting()">Reprendre</button>
        </div>
    </div>

    <div id="modal-rules" class="modal">
        <h2 style="color:var(--gold);">R√àGLES & INFOS</h2>
        <div class="glass" style="font-size:0.85rem; line-height:1.5; max-height:70vh; overflow-y:auto;">
            <p><strong>Blackjack :</strong> Le croupier s'arr√™te √† 17. Le Blackjack (As + 10/Figure) paye 3 pour 2. Vous pouvez split les paires et doubler sur vos deux premi√®res cartes.</p>
            <p><strong>Hi-Lo Counting :</strong><br>
            ‚Ä¢ 2 √† 6 = +1<br>
            ‚Ä¢ 7 √† 9 = 0<br>
            ‚Ä¢ 10, Valet, Dame, Roi, As = -1</p>
            <p><strong>True Count :</strong> Compte R√©el = Running Count / Nombre de decks restants.</p>
        </div>
        <button class="btn btn-gold" onclick="closeRules()">Fermer</button>
    </div>

    <div id="modal-analyse" class="modal">
        <h2 style="color:var(--gold);">√âTAT DU SABOT</h2>
        <div class="glass" style="text-align:center; width:85%;">
            <p style="color:var(--grey); margin-bottom:5px;">RUNNING COUNT</p>
            <div id="ana-rc" style="font-size:4rem; font-weight:bold; color:var(--gold);">0</div>
            <p style="color:var(--grey); margin-top:20px;">TRUE COUNT</p>
            <div id="ana-tc" style="font-size:1.8rem; font-weight:bold;">0</div>
        </div>
        <button class="btn btn-gold" onclick="closeAnalyse()">Retourner au jeu</button>
    </div>

    <script>
        let deck = [];
        let rc = 0;
        let countInterval = null;
        let pHands = [];
        let dHand = [];
        let currIdx = 0;
        let isGameOver = false;
        let currentMode = null;

        // --- NAVIGATION ---
        function goToGame(mode) {
            currentMode = mode;
            document.getElementById('scr-home').classList.remove('active');
            document.getElementById('nav-bar').classList.remove('hidden');
            if(mode === 'bj') {
                document.getElementById('scr-bj').classList.add('active');
                initDeck(); rc = 0; bjNewHand();
            } else {
                document.getElementById('scr-count').classList.add('active');
                document.getElementById('count-setup').classList.remove('hidden');
                document.getElementById('count-run').classList.add('hidden');
            }
        }

        function exitToHome() {
            clearInterval(countInterval);
            document.querySelectorAll('.screen, .modal').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
            document.getElementById('nav-bar').classList.add('hidden');
            document.getElementById('scr-home').classList.add('active');
            currentMode = null;
        }

        function resetCurrentGame() {
            clearInterval(countInterval);
            if(currentMode === 'bj') { initDeck(); rc = 0; bjNewHand(); }
            else { goToGame('count'); }
        }

        function showRules() { document.getElementById('modal-rules').style.display = 'flex'; }
        function closeRules() { document.getElementById('modal-rules').style.display = 'none'; }

        // --- MOTEUR DE CARTES ---
        function initDeck(n=6) {
            const v = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
            const s = ['‚ô†','‚ô•','‚ô¶','‚ô£']; deck = [];
            for(let i=0; i<n; i++) for(let suit of s) for(let val of v) deck.push({v:val, s:suit});
            deck.sort(() => Math.random() - 0.5);
        }

        function updateRC(v) {
            if(['2','3','4','5','6'].includes(v)) rc++;
            if(['10','J','Q','K','A'].includes(v)) rc--;
        }

        // --- BLACKJACK LOGIC ---
        async function bjNewHand() {
            if(deck.length < 15) initDeck();
            pHands = [{ cards: [], status: 'play' }]; dHand = [];
            currIdx = 0; isGameOver = false;
            
            document.getElementById('bj-next-btn').classList.add('hidden');
            document.getElementById('bj-actions').classList.add('hidden');
            document.getElementById('bj-d-score').innerText = "--";
            document.getElementById('hint-area').innerText = "Distribution...";

            // Distribution Casino : P1 -> D1 -> P2 -> D2
            await dealTo('p', 0);
            await dealTo('d');
            await dealTo('p', 0);
            await dealTo('d');

            const pVal = calc(pHands[0].cards);
            if(pVal === 21) {
                document.getElementById('hint-area').innerText = "üöÄ BLACKJACK !";
                finishGame();
            } else {
                document.getElementById('bj-actions').classList.remove('hidden');
                updateBJUI();
            }
        }

        async function dealTo(target, idx=0) {
            return new Promise(res => {
                setTimeout(() => {
                    const c = deck.pop();
                    updateRC(c.v);
                    if(target === 'p') pHands[idx].cards.push(c); else dHand.push(c);
                    updateBJUI();
                    res();
                }, 400);
            });
        }

        function updateBJUI() {
            // Dealer
            const dDiv = document.getElementById('bj-d-hand'); dDiv.innerHTML = "";
            dHand.forEach((c, i) => {
                const card = document.createElement('div'); card.className = "mini-card";
                if(i === 1 && !isGameOver) { card.innerText = "?"; card.style.background = "#333"; }
                else { card.innerText = c.v; card.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black'; }
                dDiv.appendChild(card);
            });

            // Players
            const wrapper = document.getElementById('bj-p-wrapper'); wrapper.innerHTML = "";
            pHands.forEach((h, i) => {
                const container = document.createElement('div');
                container.className = `glass ${i === currIdx && !isGameOver ? 'active-hand' : ''}`;
                container.innerHTML = `<div style="font-size:0.6rem; color:var(--grey)">MAIN ${i+1} ‚Ä¢ SCORE: ${calc(h.cards)}</div><div class="hand-container" id="p-h-${i}"></div>`;
                wrapper.appendChild(container);
                h.cards.forEach(c => {
                    const card = document.createElement('div'); card.className = "mini-card";
                    card.innerText = c.v; card.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black';
                    document.getElementById(`p-h-${i}`).appendChild(card);
                });
            });

            if(!isGameOver) {
                const h = pHands[currIdx];
                document.getElementById('btn-split').style.display = (h.cards.length === 2 && h.cards[0].v === h.cards[1].v) ? "block" : "none";
                document.getElementById('btn-double').style.display = (h.cards.length === 2) ? "block" : "none";
                provideHint();
            }
        }

        function provideHint() {
            const pVal = calc(pHands[currIdx].cards);
            const dVisible = valToNum(dHand[0].v);
            let h = "Conseil : ";
            if(pVal >= 17) h += "RESTEZ (Stand)";
            else if(pVal <= 11) h += "TIREZ (Hit)";
            else if(pVal >= 13 && dVisible <= 6) h += "RESTEZ (Stand)";
            else h += "TIREZ (Hit)";
            document.getElementById('hint-area').innerText = h;
        }

        async function hit() { await dealTo('p', currIdx); if(calc(pHands[currIdx].cards) > 21) nextHand(); }
        async function double() { await dealTo('p', currIdx); nextHand(); }
        async function split() {
            const h = pHands[currIdx]; const c2 = h.cards.pop();
            pHands.splice(currIdx+1, 0, {cards:[c2], status:'play'});
            await dealTo('p', currIdx); updateBJUI();
        }
        function stand() { nextHand(); }
        function nextHand() { if(currIdx < pHands.length - 1) { currIdx++; updateBJUI(); } else { finishGame(); } }

        async function finishGame() {
            isGameOver = true;
            document.getElementById('bj-actions').classList.add('hidden');
            while(calc(dHand) < 17) await dealTo('d');
            document.getElementById('bj-d-score').innerText = calc(dHand);
            document.getElementById('bj-next-btn').classList.remove('hidden');
            document.getElementById('hint-area').innerText = "FIN DE LA MANCHE";
            updateBJUI();
        }

        // --- COMPTAGE VITESSE ---
        function runCounting() {
            initDeck(6); rc = 0;
            document.getElementById('count-setup').classList.add('hidden');
            document.getElementById('count-run').classList.remove('hidden');
            document.getElementById('count-resume-btn').classList.add('hidden');
            document.getElementById('count-msg').innerText = "";
            resumeCounting();
        }

        function resumeCounting() {
            const spd = parseFloat(document.getElementById('count-spd').value) * 1000;
            document.getElementById('count-resume-btn').classList.add('hidden');
            document.getElementById('count-check-btn').classList.remove('hidden');
            
            countInterval = setInterval(() => {
                if(deck.length === 0) { clearInterval(countInterval); return alert("Fin du sabot !"); }
                const c = deck.pop();
                const el = document.getElementById('count-card-display');
                el.innerText = c.v; el.style.color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'var(--red)' : 'black';
                updateRC(c.v);

                if(document.getElementById('count-rng').checked && Math.random() < 0.1) {
                    clearInterval(countInterval);
                    document.getElementById('count-card-display').innerText = "???";
                    document.getElementById('count-msg').innerText = "TEST : Quel est le compte ?";
                    document.getElementById('count-resume-btn').classList.remove('hidden');
                }
            }, spd);
        }

        // --- ANALYSE ---
        function showAnalyse() {
            if(countInterval) clearInterval(countInterval);
            const dr = Math.max(0.5, deck.length / 52);
            document.getElementById('ana-rc').innerText = (rc > 0 ? "+" : "") + rc;
            document.getElementById('ana-tc').innerText = (rc / dr).toFixed(1);
            document.getElementById('modal-analyse').style.display = 'flex';
        }

        function closeAnalyse() {
            document.getElementById('modal-analyse').style.display = 'none';
            if(currentMode === 'count' && !document.getElementById('count-rng').checked) {
                resumeCounting();
            } else if (currentMode === 'count') {
                document.getElementById('count-resume-btn').classList.remove('hidden');
            }
        }

        // HELPERS
        function calc(h) {
            let s = 0, a = 0;
            h.forEach(c => { if(c.v === 'A') a++; else if(['J','Q','K','10'].includes(c.v)) s += 10; else s += parseInt(c.v); });
            for(let i=0; i<a; i++) s += (s + 11 <= 21) ? 11 : 1;
            return s;
        }
        function valToNum(v) { if(['J','Q','K','10'].includes(v)) return 10; if(v === 'A') return 11; return parseInt(v); }
    </script>
</body>
</html>
